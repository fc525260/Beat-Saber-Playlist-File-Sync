# Beat-Saber-playlists-and-songs-adjustment
VR游戏节奏光剑的歌单和对应曲库调整的软件。

首先感谢[WGzeyu](https://github.com/WGzeyu)的帮助。

你需要在先下载rar文件解压出来LocalCache.saver，再运行程序，注意：该文件可能过期。

使用pyqt5重构，全程使用Copilot中的GPT-4.1。

该程序是一个功能较为完善的 Beat Saber 歌单与本地歌曲文件夹管理工具，主要实现了**歌单扫描、歌曲筛选、排序、搜索、批量删除、备份、歌单同步更新**等功能。下面对主要功能实现做详细梳理：

---

## 1. 歌单与本地歌曲扫描

- **歌单文件选择**：支持选择 `.bplist` 或 `.json` 格式的歌单文件。
- **歌曲文件夹选择**：支持选择本地存放 Beat Saber 歌曲的文件夹。
- **LocalCache.saver 支持**：自动查找与程序同级的 LocalCache.saver 文件，获取歌曲的 id 和描述信息。
- **后台线程扫描**：使用 `FileProcessThread` 线程，避免界面卡顿。
- **扫描内容**：
  - 读取歌单中所有歌曲的 `songName` 和 `hash`。
  - 遍历本地每个歌曲文件夹，读取 `info.dat`，提取 `_songName`、`_songAuthorName`、所有实际存在的 `_difficulty`。
  - 检查每个文件夹下是否有 `.egg` 文件，判断歌曲是否存在。
  - 通过 hash 与 LocalCache.saver 匹配，获取 id 和描述。

---

## 2. 歌曲信息展示

- **列表显示**：每首歌显示“歌名 - 作者 [难度] (ID:xxx)”格式，难度为 info.dat 中所有实际存在的难度（如 Easy/Normal/Hard/Expert/ExpertPlus）。
- **颜色区分**：存在的歌曲为绿色，不存在为红色。
- **鼠标悬停**：显示 LocalCache.saver 中的描述（如有）。
- **详细信息区**：显示扫描统计和操作提示。

---

## 3. 歌曲筛选、排序与搜索

- **筛选下拉框**：支持“全部显示”、“普通不含困难”、“困难不含普通”、“不含普通和困难”四种筛选模式。
- **排序下拉框**：支持按歌单顺序、歌名升降序、作者升降序排序。
- **仅显示缺失歌曲**：可勾选，仅显示本地缺失的歌曲。
- **搜索框**：支持按歌名或作者模糊查找。

---

## 4. 批量操作

- **全选/取消全选**：一键全选或取消全选当前列表显示的所有歌曲。
- **批量删除**：
  - 支持批量删除选中的歌曲。
  - 删除前弹窗确认，防止误删。
  - 删除时会同步删除本地歌曲文件夹，并从歌单文件中移除对应歌曲（通过 hash 匹配）。
  - 删除后自动刷新列表。

---

## 5. 备份机制

- **备份选项**：可选“删除前备份”，默认开启。
- **备份内容**：
  - 删除前自动备份被删除的歌曲文件夹（仅备份一次，已存在不重复备份）。
  - 删除前自动备份整个原歌单文件（仅备份一次，已存在不重复备份）。
  - 备份文件夹与程序同级，名为 `backup`。

---

## 6. 歌单同步更新

- 删除歌曲后，自动更新歌单文件（移除已删除歌曲），并保存到原歌单文件路径。

---

## 7. 错误处理与健壮性

- 文件操作异常（如备份、删除、写入失败）会弹窗提示，并写入 `error.log` 日志文件。
- 所有关键操作均有异常捕获，保证程序不会因单个错误崩溃。

---

## 8. 其它细节

- **进度条**：扫描时显示进度条，完成后隐藏。
- **状态栏**：显示当前状态信息。
- **界面风格**：整体采用分组、分区布局，操作直观。

---

## 9. 一一对应性与数据同步

- 列表显示与数据操作通过 hash 绑定，确保筛选、排序、搜索后删除操作与实际数据一一对应，避免误删或漏删。

---
